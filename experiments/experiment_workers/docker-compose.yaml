networks:
  default:
    driver: bridge
  huawei1-net:
    driver: bridge
    ipam:
      config:
      - subnet: 192.168.1.0/24
  worker1-net:
    driver: bridge
    ipam:
      config:
      - subnet: 10.1.0.0/16
services:
  chaos_monkey:
    build:
      context: .
      dockerfile: chaos_monkey.Dockerfile
    command: python chaos_monkey.py --only errors
    networks:
      huawei1-net:
        ipv4_address: 192.168.1.4
      worker1-net:
        ipv4_address: 10.1.0.4
    ports:
    - 3500:3500
    volumes:
    - /home/enric/tfm/experiments/experiment_workers:/app:rw
  huawei_smartax-site-1:
    build:
      context: .
      dockerfile: huawei_smartax.Dockerfile
    command: fastapi run fakenos-web.py
    depends_on:
    - worker-site-1
    environment:
    - HOSTNAME=huawei_smartax_site_1
    - CONFIGURATION_FILE=site_1.yaml.j2
    networks:
      huawei1-net:
        ipv4_address: 192.168.1.3
  rabbitmq:
    image: rabbitmq:management
    networks:
      default: null
      worker1-net:
        ipv4_address: 10.1.0.2
    ports:
    - 5672:5672
    - 15672:15672
  redis:
    image: redis
    networks:
      worker1-net:
        ipv4_address: 10.1.0.3
    ports:
    - 6379:6379
  worker-site-1:
    build:
      context: .
      dockerfile: worker.Dockerfile
    command: python worker.py
    depends_on:
    - rabbitmq
    environment:
    - RABBITMQ_IP=10.1.0.2
    - REDIS_IP=10.1.0.3
    - CHAOS_MONKEY_IP=10.1.0.4
    - HUAWEI_SMARTAX_IP=192.168.1.3
    - HOSTNAME=worker_site_1
    - QUEUE_NAME=site_1
    - CONFIGURATION_FILE=site_1.yaml.j2
    networks:
      huawei1-net:
        ipv4_address: 192.168.1.2
      worker1-net:
        ipv4_address: 10.1.0.10
    volumes:
    - /home/enric/tfm/experiments/experiment_workers:/app:rw
